ls /ymir-workplace/
clickhouseDB  importing_pic  mysql  redis  sandbox  ymir-assets  ymir-data  ymir-models  ymir-storage  ymir-tensorboard-logs

ls /ymir-workplace
clickhouseDB  importing_pic  labelfree  mysql  redis  sandbox  ymir-assets  ymir-data  ymir-models  ymir-storage  ymir-tensorboard-logs

label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters
label_minio_1          | ERROR Unable to validate credentials inherited from the shell environment: Invalid credentials
label_minio_1          |       > Please provide correct credentials
label_minio_1          |       HINT:
label_minio_1          |         Access key length should be at least 3, and secret key length at least 8 characters

docker run -p 9000:9000 --name minio \
-d --restart=always \
-e "MINIO_ACCESS_KEY=minio" \
-e "MINIO_SECRET_KEY=minio123456" \
-v /home/data:/data \
-v /home/config:/root/.minio \
minio/minio server /data

label_redis_1          | INFO  ==> ** Starting Redis **
label_redis_1          | 1:C 11 May 2022 10:19:21.529 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
label_redis_1          | 1:C 11 May 2022 10:19:21.529 # Redis version=5.0.4, bits=64, commit=00000000, modified=0, pid=1, just started
label_redis_1          | 1:C 11 May 2022 10:19:21.529 # Configuration loaded
label_redis_1          | 1:M 11 May 2022 10:19:21.530 # Can't open the append-only file: Permission denied

ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 nginx: master process nginx -g daemon off;
    8 nginx     0:00 nginx: worker process
    9 nginx     0:00 nginx: worker process
   10 nginx     0:00 nginx: worker process
   11 nginx     0:00 nginx: worker process
   12 nginx     0:00 nginx: worker process
   13 nginx     0:00 nginx: worker process
   14 nginx     0:00 nginx: worker process
   15 nginx     0:00 nginx: worker process
   16 nginx     0:00 nginx: worker process
   17 nginx     0:00 nginx: worker process
   18 nginx     0:00 nginx: worker process
   19 nginx     0:00 nginx: worker process
   20 nginx     0:00 nginx: worker process
   21 nginx     0:00 nginx: worker process
   22 nginx     0:00 nginx: worker process
   23 nginx     0:00 nginx: worker process
   24 nginx     0:00 nginx: worker process
   25 nginx     0:00 nginx: worker process
   26 nginx     0:00 nginx: worker process
   27 nginx     0:00 nginx: worker process
   28 nginx     0:00 nginx: worker process
   29 nginx     0:00 nginx: worker process
   30 nginx     0:00 nginx: worker process
   31 nginx     0:00 nginx: worker process
   32 nginx     0:00 nginx: worker process
   33 nginx     0:00 nginx: worker process
   34 nginx     0:00 nginx: worker process
   35 nginx     0:00 nginx: worker process
   36 nginx     0:00 nginx: worker process
   37 nginx     0:00 nginx: worker process
   38 nginx     0:00 nginx: worker process
   39 nginx     0:00 nginx: worker process
   46 root      0:00 sh
   52 root      0:00 ps -ef

ps -ef
UID          PID    PPID  C STIME TTY          TIME CMD
root           1       0  0 May11 ?        00:00:10 /usr/bin/python3 /usr/local/bin/supervisord -nc supervisor/supervisord.conf
root           8       1  0 May11 ?        00:00:04 /usr/bin/python3 /usr/local/bin/gunicorn -w 1 -k uvicorn.workers.UvicornWorker -c app/gunicorn_conf.py ap
root           9       1  0 May11 ?        00:00:45 python ymir_controller/controller/server.py -d -f ymir_controller/controller/server_prd_config.yaml
root          10       1  0 May11 ?        00:00:01 python -u ymir_controller/controller/label_project_monitor.py
root          11       1  0 May11 ?        00:00:04 python ymir_monitor/monitor/utils/crontab_job.py
root          14       1  0 May11 ?        00:00:04 /usr/bin/python3 /usr/local/bin/gunicorn -w 1 -b 0.0.0.0:9098 -k uvicorn.workers.UvicornWorker monitor.ma
root          15       1  0 May11 ?        00:00:00 python pm_server.py
root          16       1  0 May11 ?        00:00:37 /usr/bin/python3 /usr/local/bin/uvicorn pm_app_server:app --port 8090 --host 0.0.0.0 --log-config uvicorn
root          17       1  0 May11 ?        00:00:05 /usr/bin/python3 /usr/local/bin/gunicorn -k gevent -c gunicorn_conf.py wsgi:connexion_app
root          25      17  0 May11 ?        00:00:07 /usr/bin/python3 /usr/local/bin/gunicorn -k gevent -c gunicorn_conf.py wsgi:connexion_app
root          27      14  0 May11 ?        00:00:38 /usr/bin/python3 /usr/local/bin/gunicorn -w 1 -b 0.0.0.0:9098 -k uvicorn.workers.UvicornWorker monitor.ma
root          28      17  0 May11 ?        00:00:06 /usr/bin/python3 /usr/local/bin/gunicorn -k gevent -c gunicorn_conf.py wsgi:connexion_app
root          31      17  0 May11 ?        00:00:07 /usr/bin/python3 /usr/local/bin/gunicorn -k gevent -c gunicorn_conf.py wsgi:connexion_app
root          33      17  0 May11 ?        00:00:06 /usr/bin/python3 /usr/local/bin/gunicorn -k gevent -c gunicorn_conf.py wsgi:connexion_app
root          64       8  0 May11 ?        00:00:45 /usr/bin/python3 /usr/local/bin/gunicorn -w 1 -k uvicorn.workers.UvicornWorker -c app/gunicorn_conf.py ap
root         858       0  0 03:35 pts/0    00:00:00 sh
root         864     858  0 03:35 pts/0    00:00:00 ps -ef

pwd
/app
ls
common  supervisor  supervisor.sock  supervisord.pid  ymir_app  ymir_controller  ymir_monitor  ymir_postman  ymir_viz

sudo docker ps
CONTAINER ID   IMAGE                                  COMMAND                  CREATED        STATUS                  PORTS
                                                NAMES
8ac457312931   jeecg-boot-system                      "/bin/sh -c 'sleep 6…"   2 months ago   Up 2 months             0.0.0.0:8080->8080/tcp, :::8080->8080/tcp                                              jeecg-boot-system
f9dfacbe15f4   jeecg-boot-mysql                       "docker-entrypoint.s…"   2 months ago   Up 2 months             33060/tcp, 0.0.0.0:3307->3306/tcp, :::3307->3306/tcp                                   jeecg-boot-mysql
d83a4cfd2808   redis:5.0                              "docker-entrypoint.s…"   2 months ago   Up 2 months             0.0.0.0:6369->6379/tcp, :::6369->6379/tcp                                              jeecg-boot-redis
4e28a297b3f2   singularities/hadoop                   "start-hadoop nameno…"   7 months ago   Up 7 months                                                                                                    hdfs_namenode_1
4f81ff62ea15   doris-camtg_doris-be                   "/home/doris/entrypo…"   7 months ago   Up 3 months                                                                                                    doris-be
0258268a75a8   doris-camtg_doris-fe                   "/home/doris/entrypo…"   7 months ago   Up 7 months                                                                                                    doris-fe
80485c5e0ff7   mongo                                  "docker-entrypoint.s…"   7 months ago   Up 7 months             0.0.0.0:27017->27017/tcp, :::27017->27017/tcp                                          mongo
88539a41ed0d   goharbor/harbor-jobservice:v2.3.1      "/harbor/entrypoint.…"   9 months ago   Up 9 months (healthy)                                                                                          harbor-jobservice
986adc55914f   goharbor/nginx-photon:v2.3.1           "nginx -g 'daemon of…"   9 months ago   Up 9 months (healthy)   0.0.0.0:8001->8080/tcp, :::8001->8080/tcp, 0.0.0.0:8002->8443/tcp, :::8002->8443/tcp   nginx
83db34b2d35c   goharbor/harbor-core:v2.3.1            "/harbor/entrypoint.…"   9 months ago   Up 9 months (healthy)                                                                                          harbor-core
05e43967a3de   goharbor/redis-photon:v2.3.1           "redis-server /etc/r…"   9 months ago   Up 9 months (healthy)
                                                redis
72f0ea957634   goharbor/harbor-registryctl:v2.3.1     "/home/harbor/start.…"   9 months ago   Up 9 months (healthy)
                                                registryctl
7b2a8c67bef2   goharbor/harbor-db:v2.3.1              "/docker-entrypoint.…"   9 months ago   Up 9 months (healthy)
                                                harbor-db
5cb6ed9bdae1   goharbor/registry-photon:v2.3.1        "/home/harbor/entryp…"   9 months ago   Up 9 months (healthy)
                                                registry
7c31827e300f   goharbor/harbor-portal:v2.3.1          "nginx -g 'daemon of…"   9 months ago   Up 9 months (healthy)
                                                harbor-portal
9dcb1b37ad56   goharbor/harbor-log:v2.3.1             "/bin/sh -c /usr/loc…"   9 months ago   Up 9 months (healthy)   127.0.0.1:1514->10514/tcp
                                                harbor-log
465a44683a6d   apache/incubator-doris:build-env-1.2   "/bin/bash"              9 months ago   Up 8 months
                                                hungry_keldysh

sudo docker ps
CONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS              PORTS                              NAMES
061d2bb8ebde        bladex/sentinel-dashboard   "java -Djava.secur..."   9 months ago        Up 9 months         8719/tcp, 0.0.0.0:8858->8858/tcp   sentinel
b2db8b95852f        nacos/nacos-server          "bin/docker-startu..."   9 months ago        Up 9 months         0.0.0.0:8848->8848/tcp             nacos

docker pull industryessentials/executor-det-yolov4-training
Using default tag: latest
8412b44cad21: Pulling fs layer
Trying to pull repository docker.io/industryessentials/executor-det-yolov4-training ...
latest: Pulling from docker.io/industryessentials/executor-det-yolov4-training
11323ed2c653: Downloading
aac8cf1d1c79: Download complete
fc85802d11de: Download complete
5ecaf0dceab7: Download complete
52ea4560e85a: Download complete
de9ca64a95e6: Download complete
e4165bf6e171: Download complete
77cc6fb46c25: Download complete
f54c7e16b308: Download complete
4e21240e72c2: Download complete
cf13d29321bf: Download complete
dfb05a7d937c: Download complete
789677c7aa9b: Download complete
ee9f566b3322: Download complete
8032c032533b: Download complete
98f18e494c27: Download complete
43962dc8a5c5: Download complete
40c01027582e: Download complete
bed4bb24b1bf: Download complete
7650dd619eef: Download complete
e8c1629610a9: Download complete
42fed07ceabc: Downloading [================>                                  ]   362 MB/1.077 GB
832db8365ca5: Download complete
43bed2fc9820: Downloading [=========>                                         ] 47.88 MB/251.9 MB
dc1d6e1c02f6: Download complete
fcb84a9dc596: Download complete
8412b44cad21: Download complete

Using default tag: latest
latest: Pulling from industryessentials/executor-det-yolov4-training
11323ed2c653: Pull complete
aac8cf1d1c79: Pull complete
fc85802d11de: Pull complete
5ecaf0dceab7: Pull complete
52ea4560e85a: Pull complete
de9ca64a95e6: Pull complete
e4165bf6e171: Pull complete
77cc6fb46c25: Pull complete
f54c7e16b308: Pull complete
4e21240e72c2: Pull complete
cf13d29321bf: Pull complete
dfb05a7d937c: Pull complete
789677c7aa9b: Pull complete
ee9f566b3322: Pull complete
8032c032533b: Pull complete
98f18e494c27: Pull complete
43962dc8a5c5: Pull complete
40c01027582e: Pull complete
bed4bb24b1bf: Pull complete
7650dd619eef: Pull complete
e8c1629610a9: Pull complete
42fed07ceabc: Pull complete
832db8365ca5: Pull complete
43bed2fc9820: Pull complete
dc1d6e1c02f6: Pull complete
fcb84a9dc596: Pull complete
8412b44cad21: Pull complete
Digest: sha256:639eeb86a9f9f5d8edb9b5905a357b99531bea68433b2791b8c7f035d24a72e6
Status: Downloaded newer image for industryessentials/executor-det-yolov4-training:latest
docker.io/industryessentials/executor-det-yolov4-training:latest

docker images |grep industryessentials
industryessentials/ymir-web                                            latest                          dae9a82c42ff   2 weeks ago     28.6MB
industryessentials/ymir-backend                                        latest                          e2719c93f0ef   2 weeks ago     676MB
industryessentials/executor-example                                    latest                          6d30c27861c5   2 weeks ago     180MB
industryessentials/executor-det-yolov4-training                        latest                          78aedb55de93   3 weeks ago     5.98GB
industryessentials/executor-det-yolov4-training                        release-0.5.0                   78aedb55de93   3 weeks ago     5.98GB
industryessentials/executor-det-yolov4-mining                          release-0.5.0                   33d61932b98f   3 weeks ago     4.14GB
industryessentials/ymir-viz-redis                                      latest                          ad31d570c5b2   7 months ago    105MB
industryessentials/ymir-backend-redis                                  latest                          c2bfba45d55c   7 months ago    149MB

unable to prepare context: unable to evaluate symlinks in Dockerfile path: lstat ~/git/ymir/Dockerfile.backend: no such file or directory

mir
usage: mir [-h] [-v] [-d] COMMAND ...

MIR

optional arguments:
  -h, --help     show this help message and exit
  -v, --version  show program's version
  -d, --debug    set debug mode, print more infos.

sub commands:
  COMMAND        Use mir COMMAND --help for sub command help
    init         init mir repo
    branch       show mir repo branches
    checkout (co)
                 checkout commits or add new branches
    commit       commit changes
    copy         copy datas from another repo
    export       export data
    filter       filter assets
    log          show mir repo log
    merge        merge contents from other branch
    reset        undo changes to repo
    sampling     sample assets
    show         show current workspace informations
    status       show current workspace status
    train        train current workspace
    mining       mine current workspace
    import       import raw data
    infer        inference images
    models       import model

Pulling label_nginx         ... done
Pulling label_api           ... done
Pulling label_celery_worker ... done
Pulling label_mysql         ... done
Pulling label_redis         ... done
Pulling label_minio         ... done

label_nginx
label_api
label_celery_worker
label_minio

Pulling redis       ...
Pulling viz-redis   ...
Pulling db          ... done
Pulling tensorboard ... done
Pulling clickhouse  ... done
Pulling backend     ...
Pulling web         ...

find / -name "labels.yaml"
/root/mir-demo-repo/.mir/labels.yaml
/ymir-workplace/sandbox/0001/000002/.mir/labels.yaml
/ymir-workplace/sandbox/0001/labels.yaml
/ymir-workplace/sandbox/0001/000001/.mir/labels.yaml

anchors:
12, 16, 19, 36, 40, 28, 36, 75, 76, 55, 72, 146, 142, 110, 192, 243, 459, 401
image_height:
608
image_width:
608
learning_rate:
0.0013
max_batches:
20000
warmup_iterations:
1000
batch:
64
subdivisions:
32
shm_size:
16G
gpu_count:
0

mir train -w /tmp/ymir/training/train-0 \
>           --media-location ~/ymir-assets \
>           --model-location ~/ymir-models \
>           --task-config-file ~/training-config.yaml \
>           --src-revs dataset-training@filtered \
>           --dst-rev training-0@trained \
>           --executor industryessentials/executor-det-yolov4-training:release-1.1.0 # 训练镜像
git result:
 M tasks.mir

[training-0 6d4c5f7] task failed
 1 file changed, 0 insertions(+), 0 deletions(-)
|-_commit_error costs 0.03s(0.00m).
command failed: training-0@trained; exc: code: 160001, message: invalid config file: /root/training-config.yaml, needs: executor_config
trace: cmd exception: Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/command_run_in_out.py", line 95, in wrapper
    ret = f(mir_root=mir_root, src_revs=src_revs, dst_rev=dst_rev, work_dir=work_dir, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/training.py", line 207, in run_with_args
    raise MirRuntimeError(
mir.tools.errors.MirRuntimeError: code: 160001, message: invalid config file: /root/training-config.yaml, needs: executor_config

Traceback (most recent call last):
  File "/usr/local/bin/mir", line 8, in <module>
    sys.exit(main())
  File "/usr/local/lib/python3.8/dist-packages/mir/main.py", line 19, in main
    return cmd.cmd_run()
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/utils.py", line 27, in wrapper
    _ret = f(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/base.py", line 17, in cmd_run
    return self.run()
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/training.py", line 152, in run
    return CmdTrain.run_with_args(work_dir=self.args.work_dir,
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/command_run_in_out.py", line 157, in wrapper
    raise exc
mir.tools.errors.MirRuntimeError: code: 160001, message: invalid config file: /root/training-config.yaml, needs: executor_config

mir train -w /tmp/ymir/training/train-0 \
>           --media-location ~/ymir-assets \
>           --model-location ~/ymir-models \
>           --task-config-file ~/training-config.yaml \
>           --src-revs dataset-training@filtered \
>           --dst-rev training-0@trained \
>           --executor industryessentials/executor-det-yolov4-training:release-1.1.0 # 训练镜像
git result:
 M tasks.mir

[training-0 76581e9] task failed
 1 file changed, 0 insertions(+), 0 deletions(-)
|-_commit_error costs 0.03s(0.00m).
command failed: training-0@trained; exc: (['git', 'rev-parse', 'dataset-training@filtered:metadatas.mir'], 128, b"fatal: Invalid object name 'dataset-training@filtered'.", b'dataset-training@filtered:metadatas.mir')
trace: cmd exception: Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/command_run_in_out.py", line 95, in wrapper
    ret = f(mir_root=mir_root, src_revs=src_revs, dst_rev=dst_rev, work_dir=work_dir, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/training.py", line 237, in run_with_args
    mir_metadatas: mirpb.MirMetadatas = mir_storage_ops.MirStorageOps.load_single_storage(
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/mir_storage_ops.py", line 220, in load_single_storage
    mir_storage_data.ParseFromString(exodus.read_mir(mir_root=mir_root, rev=rev,
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/exodus.py", line 18, in read_mir
    blob_hash = scm_git.rev_parse(f"{rev}:{file_name}")
  File "/usr/local/lib/python3.8/dist-packages/mir/scm/cmd.py", line 135, in <lambda>
    return lambda *args, **kwargs: self._call_process(name, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/mir/scm/cmd.py", line 439, in _call_process
    return self.execute(call, **exec_kwargs)  # type: ignore
  File "/usr/local/lib/python3.8/dist-packages/mir/scm/cmd.py", line 345, in execute
    raise ValueError(command, status, stderr_value, stdout_value)
ValueError: (['git', 'rev-parse', 'dataset-training@filtered:metadatas.mir'], 128, b"fatal: Invalid object name 'dataset-training@filtered'.", b'dataset-training@filtered:metadatas.mir')

Traceback (most recent call last):
  File "/usr/local/bin/mir", line 8, in <module>
    sys.exit(main())
  File "/usr/local/lib/python3.8/dist-packages/mir/main.py", line 19, in main
    return cmd.cmd_run()
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/utils.py", line 27, in wrapper
    _ret = f(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/base.py", line 17, in cmd_run
    return self.run()
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/training.py", line 152, in run
    return CmdTrain.run_with_args(work_dir=self.args.work_dir,
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/command_run_in_out.py", line 157, in wrapper
    raise exc
ValueError: (['git', 'rev-parse', 'dataset-training@filtered:metadatas.mir'], 128, b"fatal: Invalid object name 'dataset-training@filtered'.", b'dataset-training@filtered:metadatas.mir')

[t0000001000002dcf65a1653462788 eb0238e] task failed
 5 files changed, 25 deletions(-)
 rewrite annotations.mir (99%)
 rewrite keywords.mir (100%)
 rewrite metadatas.mir (100%)
 rewrite tasks.mir (99%)
|-_commit_error costs 0.03s(0.00m).
command failed: t0000001000002dcf65a1653462788@t0000001000002dcf65a1653462788; exc: [Errno 13] Permission denied: 'nvidia-docker'
trace: cmd exception: Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/mir/tools/command_run_in_out.py", line 95, in wrapper
    ret = f(mir_root=mir_root, src_revs=src_revs, dst_rev=dst_rev, work_dir=work_dir, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/training.py", line 356, in run_with_args
    _run_train_cmd(cmd, out_log_path=os.path.join(work_dir_out, mir_settings.EXECUTOR_OUTLOG_NAME))
  File "/usr/local/lib/python3.8/dist-packages/mir/commands/training.py", line 93, in _run_train_cmd
    subprocess.run(cmd, check=True, stdout=f, stderr=f, text=True)
  File "/usr/lib/python3.8/subprocess.py", line 493, in run
    with Popen(*popenargs, **kwargs) as process:
  File "/usr/lib/python3.8/subprocess.py", line 858, in __init__
    self._execute_child(args, executable, preexec_fn, close_fds,
  File "/usr/lib/python3.8/subprocess.py", line 1704, in _execute_child
    raise child_exception_type(errno_num, err_msg, err_filename)
PermissionError: [Errno 13] Permission denied: 'nvidia-docker'

ERROR:fastapi:[viz] failed to get model info: b'{"code":140402,"message":"model t0000001000002dcf65a1653462788 not found"}\n'
ERROR:fastapi:[update task] failed to get model from task
Traceback (most recent call last):
  File "/app/ymir_app/app/libs/tasks.py", line 219, in model_info
    result = self.viz.get_model()
  File "/app/ymir_app/app/utils/ymir_viz.py", line 193, in get_model
    res = self.parse_resp(resp)
  File "/app/ymir_app/app/utils/ymir_viz.py", line 225, in parse_resp
    raise ModelNotFound()
app.api.errors.errors.ModelNotFound

ERROR   : [20220525-07:13:49] base.py:131:run_job(): Job "lable_task_monitor (trigger: interval[0:00:10], next run at: 2022-05-25 07:15:24 UTC)" raised an exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/apscheduler/executors/base.py", line 125, in run_job
    retval = job.func(*job.args, **job.kwargs)
  File "ymir_controller/controller/label_project_monitor.py", line 63, in lable_task_monitor
    label_instance = utils.create_label_instance()
  File "/app/ymir_controller/controller/utils/utils.py", line 97, in create_label_instance
    raise ValueError("Error! Please setting your label tools")
ValueError: Error! Please setting your label tools

sudo yum install -y nvidia-docker2
Loaded plugins: fastestmirror, langpacks
Repository epel is listed more than once in the configuration
Loading mirror speeds from cached hostfile
docker-ce-stable                                                                                                                      | 3.5 kB  00:00:00
epel                                                                                                                                  | 4.7 kB  00:00:00
extras                                                                                                                                | 2.9 kB  00:00:00
kubernetes                                                                                                                            | 1.4 kB  00:00:00
libnvidia-container/x86_64/signature                                                                                                  |  833 B  00:00:00
Retrieving key from https://nvidia.github.io/libnvidia-container/gpgkey
Importing GPG key 0xF796ECB0:
 Userid     : "NVIDIA CORPORATION (Open Source Projects) <cudatools@nvidia.com>"
 Fingerprint: c95b 321b 61e8 8c18 09c4 f759 ddca e044 f796 ecb0
 From       : https://nvidia.github.io/libnvidia-container/gpgkey
libnvidia-container/x86_64/signature                                                                                                  | 2.1 kB  00:00:00 !!!
mysql-connectors-community                                                                                                            | 2.6 kB  00:00:00
mysql-tools-community                                                                                                                 | 2.6 kB  00:00:00
mysql80-community                                                                                                                     | 2.6 kB  00:00:00
nodesource                                                                                                                            | 2.5 kB  00:00:00
os                                                                                                                                    | 3.6 kB  00:00:00
updates                                                                                                                               | 2.9 kB  00:00:00
(1/4): updates/7/x86_64/primary_db                                                                                                    |  16 MB  00:00:00
(2/4): epel/7/x86_64/updateinfo                                                                                                       | 1.0 MB  00:00:00
(3/4): epel/7/x86_64/primary_db                                                                                                       | 7.0 MB  00:00:00
(4/4): libnvidia-container/x86_64/primary                                                                                             |  24 kB  00:00:00
libnvidia-container                                                                                                                                  155/155
Resolving Dependencies
--> Running transaction check
---> Package nvidia-docker2.noarch 0:2.10.0-1 will be installed
--> Processing Dependency: nvidia-container-toolkit >= 1.9.0-1 for package: nvidia-docker2-2.10.0-1.noarch
--> Running transaction check
---> Package nvidia-container-toolkit.x86_64 0:1.9.0-1 will be installed
--> Processing Dependency: libnvidia-container-tools < 2.0.0 for package: nvidia-container-toolkit-1.9.0-1.x86_64
--> Processing Dependency: libnvidia-container-tools >= 1.9.0-1 for package: nvidia-container-toolkit-1.9.0-1.x86_64
--> Running transaction check
---> Package libnvidia-container-tools.x86_64 0:1.9.0-1 will be installed
--> Processing Dependency: libnvidia-container1(x86-64) >= 1.9.0-1 for package: libnvidia-container-tools-1.9.0-1.x86_64
--> Processing Dependency: libnvidia-container.so.1(NVC_1.0)(64bit) for package: libnvidia-container-tools-1.9.0-1.x86_64
--> Processing Dependency: libnvidia-container.so.1()(64bit) for package: libnvidia-container-tools-1.9.0-1.x86_64
--> Running transaction check
---> Package libnvidia-container1.x86_64 0:1.9.0-1 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=============================================================================================================================================================
 Package                                         Arch                         Version                        Repository                                 Size
=============================================================================================================================================================
Installing:
 nvidia-docker2                                  noarch                       2.10.0-1                       libnvidia-container                       8.7 k
Installing for dependencies:
 libnvidia-container-tools                       x86_64                       1.9.0-1                        libnvidia-container                        49 k
 libnvidia-container1                            x86_64                       1.9.0-1                        libnvidia-container                       1.0 M
 nvidia-container-toolkit                        x86_64                       1.9.0-1                        libnvidia-container                       1.5 M

Transaction Summary
=============================================================================================================================================================
Install  1 Package (+3 Dependent packages)

Total download size: 2.5 M
Installed size: 7.4 M
Downloading packages:
(1/4): libnvidia-container-tools-1.9.0-1.x86_64.rpm                                                                                   |  49 kB  00:00:04
(2/4): libnvidia-container1-1.9.0-1.x86_64.rpm                                                                                        | 1.0 MB  00:00:40
(3/4): nvidia-docker2-2.10.0-1.noarch.rpm                                                                                             | 8.7 kB  00:00:01
(4/4): nvidia-container-toolkit-1.9.0-1.x86_64.rpm                                                                                    | 1.5 MB  00:00:50
-------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                         47 kB/s | 2.5 MB  00:00:54
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : libnvidia-container1-1.9.0-1.x86_64                                                                                                       1/4
  Installing : libnvidia-container-tools-1.9.0-1.x86_64                                                                                                  2/4
  Installing : nvidia-container-toolkit-1.9.0-1.x86_64                                                                                                   3/4
  Installing : nvidia-docker2-2.10.0-1.noarch                                                                                                            4/4
Error unpacking rpm package nvidia-docker2-2.10.0-1.noarch
warning: /etc/docker/daemon.json saved as /etc/docker/daemon.json.rpmorig
error: unpacking of archive failed on file /usr/bin/nvidia-docker: cpio: rename
error: nvidia-docker2-2.10.0-1.noarch: install failed
  Verifying  : libnvidia-container-tools-1.9.0-1.x86_64                                                                                                  1/4
  Verifying  : nvidia-container-toolkit-1.9.0-1.x86_64                                                                                                   2/4
  Verifying  : libnvidia-container1-1.9.0-1.x86_64                                                                                                       3/4
  Verifying  : nvidia-docker2-2.10.0-1.noarch                                                                                                            4/4

Dependency Installed:
  libnvidia-container-tools.x86_64 0:1.9.0-1            libnvidia-container1.x86_64 0:1.9.0-1            nvidia-container-toolkit.x86_64 0:1.9.0-1

Failed:
  nvidia-docker2.noarch 0:2.10.0-1

Complete!

error: unpacking of archive failed on file /usr/bin/nvidia-docker: cpio: rename
chattr -i /usr/bin
lsattr /usr
-------------e-- /usr/lib
-------------e-- /usr/etc
-------------e-- /usr/local
-------------e-- /usr/games
-------------e-- /usr/share
----------I--e-- /usr/bin
-------------e-- /usr/libexec
-------------e-- /usr/src
----------I--e-- /usr/lib64
----------I--e-- /usr/sbin
-------------e-- /usr/include

INFO:fastapi:handling payloads [('1653464903397-0', {'payload': '{"raw_log_contents": {"/ymir-workplace/sandbox/work_dir/TaskTypeTraining/t00000010000027b2e671653464881/sub_task/t00000010000027b2e671653464881/out/monitor.txt": {"task_id": "t00000010000027b2e671653464881", "timestamp": "1653464886.95095", "percent": 1.0, "state": 4, "state_code": 160004, "state_message": "container error occured", "stack_error_info": "EXECUTOR OUTLOG TAIL FROM: /ymir-workplace/sandbox/work_dir/TaskTypeTraining/t00000010000027b2e671653464881/sub_task/t00000010000027b2e671653464881/out/ymir-executor-out.log\\n\\n  File \\"/usr/local/lib/python3.7/dist-packages/mxnet/base.py\\", line 204, in _load_lib\\n\\n    lib = ctypes.CDLL(lib_path[0], ctypes.RTLD_LOCAL)\\n\\n  File \\"/usr/lib/python3.7/ctypes/__init__.py\\", line 364, in __init__\\n\\n    self._handle = _dlopen(self._name, mode)\\n\\nOSError: libcuda.so.1: cannot open shared object file: No such file or directory\\n\\n\\n"}, "/ymir-workplace/sandbox/work_dir/TaskTypeTraining/t00000010000027b2e671653464881/sub_task/t10000010000027b2e671653464881/out/monitor.txt": {"task_id": "t10000010000027b2e671653464881", "timestamp": "1653464882.095823", "percent": 1.0, "state": 3, "state_code": 0, "state_message": null, "stack_error_info": null}}, "task_extra_info": {"user_id": "0001", "monitor_type": 1, "log_path_weights": {"/ymir-workplace/sandbox/work_dir/TaskTypeTraining/t00000010000027b2e671653464881/sub_task/t00000010000027b2e671653464881/out/monitor.txt": 1.0, "/ymir-workplace/sandbox/work_dir/TaskTypeTraining/t00000010000027b2e671653464881/sub_task/t10000010000027b2e671653464881/out/monitor.txt": 0.0}, "description": null}, "percent_result": {"task_id": "t00000010000027b2e671653464881", "timestamp": "1653464886.95095", "percent": 1.0, "state": 4, "state_code": 160004, "state_message": "container error occured", "stack_error_info": "EXECUTOR OUTLOG TAIL FROM: /ymir-workplace/sandbox/work_dir/TaskTypeTraining/t00000010000027b2e671653464881/sub_task/t00000010000027b2e671653464881/out/ymir-executor-out.log\\n\\n  File \\"/usr/local/lib/python3.7/dist-packages/mxnet/base.py\\", line 204, in _load_lib\\n\\n    lib = ctypes.CDLL(lib_path[0], ctypes.RTLD_LOCAL)\\n\\n  File \\"/usr/lib/python3.7/ctypes/__init__.py\\", line 364, in __init__\\n\\n    self._handle = _dlopen(self._name, mode)\\n\\nOSError: libcuda.so.1: cannot open shared object file: No such file or directory\\n\\n\\n"}}'})]

docker ps
CONTAINER ID   IMAGE                                  COMMAND                  CREATED        STATUS                  PORTS
                                                NAMES
8ac457312931   jeecg-boot-system                      "/bin/sh -c 'sleep 6…"   3 months ago   Up 3 months             0.0.0.0:8080->8080/tcp, :::8080->8080/tcp                                              jeecg-boot-system
f9dfacbe15f4   jeecg-boot-mysql                       "docker-entrypoint.s…"   3 months ago   Up 3 months             33060/tcp, 0.0.0.0:3307->3306/tcp, :::3307->3306/tcp                                   jeecg-boot-mysql
d83a4cfd2808   redis:5.0                              "docker-entrypoint.s…"   3 months ago   Up 3 months             0.0.0.0:6369->6379/tcp, :::6369->6379/tcp                                              jeecg-boot-redis
4e28a297b3f2   singularities/hadoop                   "start-hadoop nameno…"   7 months ago   Up 7 months
                                                hdfs_namenode_1
4f81ff62ea15   doris-camtg_doris-be                   "/home/doris/entrypo…"   7 months ago   Up 4 months
                                                doris-be
0258268a75a8   doris-camtg_doris-fe                   "/home/doris/entrypo…"   7 months ago   Up 7 months
                                                doris-fe
80485c5e0ff7   mongo                                  "docker-entrypoint.s…"   8 months ago   Up 8 months             0.0.0.0:27017->27017/tcp, :::27017->27017/tcp                                          mongo
88539a41ed0d   goharbor/harbor-jobservice:v2.3.1      "/harbor/entrypoint.…"   9 months ago   Up 9 months (healthy)
                                                harbor-jobservice
986adc55914f   goharbor/nginx-photon:v2.3.1           "nginx -g 'daemon of…"   9 months ago   Up 9 months (healthy)   0.0.0.0:8001->8080/tcp, :::8001->8080/tcp, 0.0.0.0:8002->8443/tcp, :::8002->8443/tcp   nginx
83db34b2d35c   goharbor/harbor-core:v2.3.1            "/harbor/entrypoint.…"   9 months ago   Up 9 months (healthy)
                                                harbor-core
05e43967a3de   goharbor/redis-photon:v2.3.1           "redis-server /etc/r…"   9 months ago   Up 9 months (healthy)
                                                redis
72f0ea957634   goharbor/harbor-registryctl:v2.3.1     "/home/harbor/start.…"   9 months ago   Up 9 months (healthy)
                                                registryctl
7b2a8c67bef2   goharbor/harbor-db:v2.3.1              "/docker-entrypoint.…"   9 months ago   Up 9 months (healthy)
                                                harbor-db
5cb6ed9bdae1   goharbor/registry-photon:v2.3.1        "/home/harbor/entryp…"   9 months ago   Up 9 months (healthy)
                                                registry
7c31827e300f   goharbor/harbor-portal:v2.3.1          "nginx -g 'daemon of…"   9 months ago   Up 9 months (healthy)
                                                harbor-portal
9dcb1b37ad56   goharbor/harbor-log:v2.3.1             "/bin/sh -c /usr/loc…"   9 months ago   Up 9 months (healthy)   127.0.0.1:1514->10514/tcp
                                                harbor-log
465a44683a6d   apache/incubator-doris:build-env-1.2   "/bin/bash"              9 months ago   Up 8 months
                                                hungry_keldysh

docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: process_linux.go:545: container init caused: Running hook #1:: error running hook: exit status 1, stdout: , stderr: nvidia-container-cli: initialization error: load library failed: libnvidia-ml.so.1: cannot open shared object file: no such file or directory: unknown.

sudo docker-compose -f docker-compose.labelfree.yml ps
            Name                          Command               State                                         Ports
----------------------------------------------------------------------------------------------------------------------------------------------------------
docker_label_api_1             sh /code/entrypoint.sh gun ...   Up
docker_label_celery_worker_1   sh /code/entrypoint.sh cel ...   Up
docker_label_minio_1           /usr/bin/docker-entrypoint ...   Up      0.0.0.0:9099->9000/tcp,:::9099->9000/tcp, 0.0.0.0:9004->9001/tcp,:::9004->9001/tcp
docker_label_mysql_1           docker-entrypoint.sh --cha ...   Up      3306/tcp
docker_label_nginx_1           /docker-entrypoint.sh ngin ...   Up      0.0.0.0:8763->80/tcp,:::8763->80/tcp
docker_label_redis_1           docker-entrypoint.sh redis ...   Up      6379/tcp

sudo docker exec -it docker_label_mysql_1 bash
mysql -h127.0.0.1 -uroot -p
show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| labelfree          |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.00 sec)
use labelfree
show tables;
+---------------------+
| Tables_in_labelfree |
+---------------------+
| alembic_version     |
| annotation          |
| attachments         |
| datasets            |
| export              |
| image_annotation    |
| images              |
| label_system        |
| menus               |
| project             |
| project_group       |
| role_permission     |
| roles               |
| storage             |
| user_role           |
| users               |
+---------------------+
16 rows in set (0.00 sec)

delete from users where id=1;
update user_role set user_id=2,role_id=1 where id=2;
